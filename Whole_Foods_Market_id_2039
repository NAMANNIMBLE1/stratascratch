-- unique transactions and total sales for each products categories 
-- year == 2017
-- order by total_sales desc 
-- output product categories , no of transzations , total sales 

WITH cte as (
    SELECT 
        DISTINCT transaction_id , product_category , 
        COUNT(transaction_id) as no_of_transactions,
        SUM(sales) as total_sales,
        EXTRACT(YEAR from transaction_date) as year
    FROM wfm_transactions a 
    LEFT JOIN wfm_products b
    ON a.product_id = b.product_id
    GROUP BY product_category 
    ORDER BY SUM(sales)
    DESC
)

SELECT DISTINCT 
no_of_transactions,
product_category,
total_sales
from cte
where year = 2017;
